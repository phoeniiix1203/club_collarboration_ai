<!DOCTYPE html>
<!--
Copyright 2018 Reiichiro Nakano All Rights Reserved.
Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at
http://www.apache.org/licenses/LICENSE-2.0
Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
==============================================================================
-->
<html lang="en">

<head>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-91864013-5');
  </script>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Galaxy2Painting</title>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css"
    integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">

  <!-- Bootstrap core CSS -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css" rel="stylesheet">
  <script src="dist/bundle.js"></script>
</head>

<style>
  .centered {
    margin: auto;
    display: block;
  }
</style>

<body>
  <input type="file" id="file-select" style="display: none" accept="image/x-png,image/gif,image/jpeg" />
  <!-- As a heading -->
  <div class="jumbotron jumbotron-fluid py-4" style="text-align: center; background-color: #f5f5f5;">
    <div class="container">
      <h4>Galaxy2Painting</h1>
    </div>
  </div>
  <div class="">
    <div id="mobile-warning" hidden class="alert alert-warning" role="alert">
      This site may have problems functioning on mobile devices.
      Don't worry, you can still read the description below!
    </div>
    <ul class="nav nav-tabs nav-fill" id="myTab" role="tablist">
      <li class="nav-item">
        <a class="nav-link active" id="stylize-tab" data-toggle="tab" href="#stylize" role="tab" aria-controls="stylize"
          aria-selected="true">Stylize an Image</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="combine-tab" data-toggle="tab" href="#combine" role="tab" aria-controls="combine"
          aria-selected="false">FAQ</a>
      </li>
    </ul>
    <div class="tab-content" id="myTabContent">
      <div class="tab-pane fade show active" id="stylize" role="tabpanel" aria-labelledby="stylize-tab">
        <div class="container">
          <div class="row my-4">
            <div class="col mx-5 my-4">
              <img id="content-img" class="centered" src="images/example.jpg" height=256></img>
              <br>
              <label for="content-img-size">Content Image Size</label>
              <i class="far fa-question-circle" data-toggle="tooltip" data-placement="top"
                title="A bigger content image results in a more detailed output, but increases the processing time significantly."></i>
              <input type="range" min="256" max="400" value="256" class="custom-range centered" id="content-img-size">
              <br>
              <select id="content-select" class="centered custom-select">
                <option value="example" selected="selected">Example</option>
                <option value="file">Upload Image</option>
              </select>
            </div>
            <div class="col mx-5 my-4">
              <img id="style-img" class="centered" crossorigin="anonymous" src="images/sketch.jpg" height=256></img>
              <br>
              <label for="style-img-size">Style Image Size</label>
              <i class="far fa-question-circle" data-toggle="tooltip" data-placement="top"
                title='Changing the size of a style image usually affects the texture "seen" by the network.'></i>
              <input id="style-img-square" type="checkbox" style="vertical-align: middle; float: right;"
                data-toggle="tooltip" data-placement="top" title="Force image to square">
              <input type="range" min="100" max="400" value="256" class="custom-range centered" id="style-img-size">
              <br>
              <select id="style-select" class="centered custom-select">
                <option value="sketch" selected="selected">Sketch</option>
                <option value="surrealism">Surrealism</option>
                <option value="crayon_drawing">Crayon Drawing</option>
                <option value="black_and_white">Black and White</option>
                <option value="random">Random Image from wikiart.org</option>
                <option value="file">Upload Image</option>
              </select>
            </div>
          </div>

          <div class="row my-4">
            <div class="col-md-6 offset-md-3">
              <canvas id="stylized" class="centered"></canvas>
              <br>
              <label for="stylized-img-ratio">Stylization Strength</label>
              <i class="far fa-question-circle" data-toggle="tooltip" data-placement="top"
                title="This parameter affects the stylization strength. The further to the right, the stronger the stylization."></i>
              <input type="range" min="0" max="100" value="100" class="custom-range centered" id="stylized-img-ratio">
            </div>
          </div>
          <div class="row my-4">
            <div class="col-md-5 offset-md-3">
              <button disabled id="style-button" type="button" class="btn btn-primary btn-block">Loading stylization
                model. Please wait..</button>
            </div>
            <div class="col-md-1">
              <button type="button" id="randomize" class="btn btn-light btn-block">
                <i class="fas fa-random" data-toggle="tooltip" data-placement="top" title="Randomize parameters"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
      <!--  -->

      <div class="tab-pane fade" id="combine" role="tabpanel" aria-labelledby="combine-tab">
        <div class="row pt-5">
          <div class="col-md-4 offset-md-4">
            <h5>
              What is this?
            </h5>
            <p>
              This is an implementation of an arbitrary style transfer algorithm
              running purely in the browser using TensorFlow.js. As with all neural
              style transfer algorithms, a neural network attempts to "draw" one
              picture, the Content (usually a photograph), in the style of another,
              the Style (usually a painting).
            </p>
            <p>
              Although <a href="https://github.com/reiinakano/fast-style-transfer-deeplearnjs">other browser
                implementations</a> of style transfer exist,
              they are normally limited to a pre-selected handful of styles, due to
              the requirement that a separate neural network must be trained for each
              style image.
            </p>
            <p>
              Arbitrary style transfer works around this limitation by using a
              separate <i>style network</i> that learns to break down <i>any</i> image into
              a 100-dimensional vector representing its style. This style vector is
              then fed into another network, the <i>transformer network</i>, along
              with the content image, to produce the final stylized image.
            </p>
            <p>
              I have written a <a href="https://magenta.tensorflow.org/blog/2018/12/20/style-transfer-js/">blog post</a>
              explaining this project in more detail.
            </p>
          </div>
        </div>
        <div class="row pt-5">
          <div class="col-md-4 offset-md-4">
            <h5>
              Is my data safe? Can you see my pictures?
            </h5>
            <p>
              Your data and pictures here never leave your computer! In fact,
              this is one of the main advantages of running neural networks
              in your browser. Instead of sending us your data, we send *you*
              both the model *and* the code to run the model. These are then
              run by your browser.
            </p>
          </div>
        </div>
        <div class="row pt-5">
          <div class="col-md-4 offset-md-4">
            <h5>
              What are all these different models?
            </h5>
            <p>
              The original paper uses an Inception-v3 model
              as the style network, which takes up ~36.3MB
              when ported to the browser as a FrozenModel.
            </p>
            <p>
              In order to make this model smaller, a MobileNet-v2 was
              used to distill the knowledge from the pretrained Inception-v3
              style network. This resulted in a size reduction of just under 4x,
              from ~36.3MB to ~9.6MB, at the expense of some quality.
            </p>
            <p>
              For the transformer network, the original paper uses
              a model using plain convolution layers. When ported to
              the browser, this model takes up 7.9MB and is responsible
              for the majority of the calculations during stylization.
            </p>
            <p>
              In order to make the transformer model more efficient, most of the
              plain convolution layers were replaced with depthwise separable
              convolutions. This reduced the model size to 2.4MB, while
              drastically improving the speed of stylization.
            </p>
            <p>
              This demo lets you use any combination of the models, defaulting
              to the MobileNet-v2 style network and the separable convolution
              transformer network.
            </p>
          </div>
        </div>
        <div class="row pt-5">
          <div class="col-md-4 offset-md-4">
            <h5>
              How big are the models I'm downloading?
            </h5>
            <p>
              The distilled style network is ~9.6MB, while the separable convolution
              transformer network is ~2.4MB,
              for a total of ~12MB. Since these models work for any style, you only
              have to download them once!
            </p>
          </div>
        </div>
        <button disabled id="combine-button" type="button" class="btn btn-primary btn-block" hidden=True></button>
      </div>
      <div id="model-select-style" value="mobilenet"></div>
      <div id="model-select-transformer" value="selected"></div>

      <canvas id="hidden-canvas" style="display: none"></canvas>
      <div class="modal fade" id="cam-modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Take a snapshot!</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <video id="webcam-video" class="centered" width="500" height="375"></video>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
              <button type="button" class="btn btn-primary" id="snap-button">Snap!</button>
            </div>
          </div>
        </div>
      </div>

      <!-- JQuery -->
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
      <!-- Bootstrap tooltips -->
      <script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.4/umd/popper.min.js"></script>
      <!-- Bootstrap core JavaScript -->
      <script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.min.js"></script>

      <script type="text/javascript">
        $(function () {
          $('[data-toggle="tooltip"]').tooltip()
        })
      </script>
</body>

</html>